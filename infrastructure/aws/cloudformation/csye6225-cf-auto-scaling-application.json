{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Application Stack for CSYE6225",
    "Parameters": {
        "NetworkStackNameParameter": {
            "Description": "Network Stack Name",
            "Type": "String"
        },
        "ApplicationStackNameParameter": {
            "Description": "Application Stack Name",
            "Type": "String"
        },
        "KeyName": {
            "Description": "EC2 KeyPair to enable SSH access to the instance",
            "Type": "AWS::EC2::KeyPair::KeyName"
        },
        "ImageID": {
            "Type": "String"
        },
        "PublicSubnetKey3": {
            "Type": "String"
        },
        "PublicSubnetKey2": {
            "Type": "String"
        },
        "PublicSubnetKey1": {
            "Type": "String"
        },
        "VpcID": {
            "Type": "String"
        },
        "S3UploadBucket": {
            "Type": "String"
        },
        "S3CDBucket": {
            "Type": "String"
        },
        "Domain": {
            "Type": "String"
        },
        "certificateARN": {
            "Type": "String"
        },
        "stackPrefix": {
            "Type": "String",
            "Description": "The prefix to use when naming resources in this stack. Normally we would use the stack name, but since this template can be used as a resource in other stacks we want to keep the naming consistent. No symbols allowed.",
            "ConstraintDescription": "Alphanumeric characters only, maximum 10 characters",
            "AllowedPattern": "^[a-zA-z0-9]+$",
            "MaxLength": 10,
            "Default": "generic"
        },
        "stackScope": {
            "Type": "String",
            "Description": "You can deploy this stack at a regional level, for regional WAF targets like Application Load Balancers, or for global targets, such as Amazon CloudFront distributions.",
            "AllowedValues": [
                "Global",
                "Regional"
            ],
            "Default": "Regional"
        },
        "ruleAction": {
            "Type": "String",
            "Description": "The type of action you want to iplement for the rules in this set. Valid options are COUNT or BLOCK.",
            "AllowedValues": [
                "BLOCK",
                "COUNT"
            ],
            "Default": "BLOCK"
        },
        "includesPrefix": {
            "Type": "String",
            "Description": "This is the URI path prefix (starting with '/') that identifies any files in your webroot that are server-side included components, and should not be invoked directly via URL. These can be headers, footers, 3rd party server side libraries or components. You can add additional prefixes later directly in the set.",
            "Default": "/includes"
        },
        "adminUrlPrefix": {
            "Type": "String",
            "Description": "This is the URI path prefix (starting with '/') that identifies your administrative sub-site. You can add additional prefixes later directly in the set.",
            "Default": "/admin"
        },
        "adminRemoteCidr": {
            "Type": "String",
            "Description": "This is the IP address allowed to access your administrative interface. Use CIDR notation. You can add additional ones later directly in the set.",
            "Default": "127.0.0.1/32"
        },
        "maxExpectedURISize": {
            "Type": "Number",
            "Description": "Maximum number of bytes allowed in the URI component of the HTTP request. Generally the maximum possible value is determined by the server operating system (maps to file system paths), the web server software, or other middleware components. Choose a value that accomodates the largest URI segment you use in practice in your web application.",
            "Default": 512
        },
        "maxExpectedQueryStringSize": {
            "Type": "Number",
            "Description": "Maximum number of bytes allowed in the query string component of the HTTP request. Normally the  of query string parameters following the \"?\" in a URL is much larger than the URI , but still bounded by the  of the parameters your web application uses and their values.",
            "Default": 1024
        },
        "maxExpectedBodySize": {
            "Type": "Number",
            "Description": "Maximum number of bytes allowed in the body of the request. If you do not plan to allow large uploads, set it to the largest payload value that makes sense for your web application. Accepting unnecessarily large values can cause performance issues, if large payloads are used as an attack vector against your web application.",
            "Default": 4096
        },
        "maxExpectedCookieSize": {
            "Type": "Number",
            "Description": "Maximum number of bytes allowed in the cookie header. The maximum size should be less than 4096, the size is determined by the amount of information your web application stores in cookies. If you only pass a session token via cookies, set the size to no larger than the serialized size of the session token and cookie metadata.",
            "Default": 4093
        },
        "csrfExpectedHeader": {
            "Type": "String",
            "Description": "The custom HTTP request header, where the CSRF token value is expected to be encountered",
            "Default": "x-csrf-token"
        },
        "csrfExpectedSize": {
            "Type": "Number",
            "Description": "The size in bytes of the CSRF token value. For example if it's a canonically formatted UUIDv4 value the expected size would be 36 bytes/ASCII characters",
            "Default": 36
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Resource Prefix"
                    },
                    "Parameters": [
                        "stackPrefix"
                    ]
                },
                {
                    "Label": {
                        "default": "WAF Implementation"
                    },
                    "Parameters": [
                        "stackScope",
                        "ruleAction"
                    ]
                },
                {
                    "Label": {
                        "default": "Generic HTTP Request Enforcement"
                    },
                    "Parameters": [
                        "maxExpectedURISize",
                        "maxExpectedQueryStringSize",
                        "maxExpectedBodySize",
                        "maxExpectedCookieSize"
                    ]
                },
                {
                    "Label": {
                        "default": "Administrative Interface"
                    },
                    "Parameters": [
                        "adminUrlPrefix",
                        "adminRemoteCidr"
                    ]
                },
                {
                    "Label": {
                        "default": "Cross-Site Request Forgery (CSRF)"
                    },
                    "Parameters": [
                        "csrfExpectedHeader",
                        "csrfExpectedSize"
                    ]
                },
                {
                    "Label": {
                        "default": "Application Specific"
                    },
                    "Parameters": [
                        "includesPrefix"
                    ]
                }
            ],
            "ParameterLabels": {
                "stackPrefix": {
                    "default": "Resource Name Prefix"
                },
                "stackScope": {
                    "default": "Apply to WAF"
                },
                "ruleAction": {
                    "default": "Rule Effect"
                },
                "includesPrefix": {
                    "default": "Server-side components URI prefix"
                },
                "adminUrlPrefix": {
                    "default": "URI prefix"
                },
                "adminRemoteCidr": {
                    "default": "Allowed IP source (CIDR)"
                },
                "maxExpectedURISize": {
                    "default": "Max. size of URI"
                },
                "maxExpectedQueryStringSize": {
                    "default": "Max. size of QUERY STRING"
                },
                "maxExpectedBodySize": {
                    "default": "Max. size of BODY"
                },
                "maxExpectedCookieSize": {
                    "default": "Max. size of COOKIE"
                },
                "csrfExpectedHeader": {
                    "default": "HTTP Request Header"
                },
                "csrfExpectedSize": {
                    "default": "Token Size"
                }
            }
        },
        "AWS::CloudFormation::Designer": {
            "da80931f-bd6d-4a5b-a8cb-aa1df35d01a5": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 360,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "a6204b71-dee6-4d80-a3f9-c19562fd2b9d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 360,
                    "y": 210
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "da80931f-bd6d-4a5b-a8cb-aa1df35d01a5"
                ]
            },
            "3397aaba-35d9-406a-81ae-247e7ec8060b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 360,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "161434a6-6b19-4347-aee2-8e8f89edd24f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 390
                },
                "z": 1,
                "embeds": []
            },
            "346ce274-6cc7-4d17-b8fe-735207ce9f17": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 390
                },
                "z": 1,
                "embeds": []
            },
            "1b8d4d1a-a3d7-4e42-9dca-95a8aae00eb3": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 480,
                    "y": 90
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "346ce274-6cc7-4d17-b8fe-735207ce9f17"
                ]
            },
            "756988d9-a264-4226-9208-10be616ca979": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 480,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "3ff95f6c-f4aa-4cc1-a977-e830e7ff177d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 480,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "7391a19a-be13-442f-beeb-d17b439cce4a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "2f0bd676-3f4d-45c3-9b73-312436e08416": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "0203efb8-0b45-4c34-bf29-f18d6f92d2ad": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "14b55ae1-cdec-4eac-abcd-eb900a248c0e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 510
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "7391a19a-be13-442f-beeb-d17b439cce4a",
                    "0203efb8-0b45-4c34-bf29-f18d6f92d2ad"
                ]
            },
            "44d8b0e1-c5bc-4247-8efa-30005af35691": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 510
                },
                "z": 1,
                "embeds": []
            },
            "6dfd967c-870d-45f4-b027-2622e025bc90": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "48ce54ea-e507-407c-ab74-39d93f716061": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "6fa7ebbe-9e54-4249-873a-e43ec72d9275": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "48ce54ea-e507-407c-ab74-39d93f716061"
                ]
            },
            "aea99dd6-97d5-42df-a4e0-9e94de92485a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 600,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "235054b3-99cf-468c-a227-4f1fe0773b43": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 600,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "b8ad925e-e972-4215-8ff8-f7e20ca765c6": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 600,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "4502d546-8948-490c-9291-470540e4d3e8": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "8fcdb0db-501a-4e8c-924b-e80c1b8ac849": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "422743cb-47fa-421c-a59b-4a845d4e2ff4": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 630
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "8fcdb0db-501a-4e8c-924b-e80c1b8ac849",
                    "b8ad925e-e972-4215-8ff8-f7e20ca765c6"
                ]
            },
            "be92c255-8d67-44d5-acf1-9d64226f9235": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 630
                },
                "z": 1,
                "embeds": []
            },
            "655821ea-6dfc-4a68-bd37-52acaab07968": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 720,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "5d36b19e-1817-4edf-9964-80ecae53cae4": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 720,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "337679ee-801b-45c2-be04-173d80315c36": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 720,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "4c9c1a5e-3021-4f61-b415-c16d1ddfba47": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "5fdfeb99-32f1-4fca-b339-422f4766ce12": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 690
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "5d36b19e-1817-4edf-9964-80ecae53cae4",
                    "4c9c1a5e-3021-4f61-b415-c16d1ddfba47"
                ]
            },
            "ba148479-6b59-4a75-9fa5-f7ddc060978b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "26770ce2-1075-49c4-8157-97507fc57eb8": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "f24b84fa-3da3-4a1b-ac9f-6f6a48e3032c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 750
                },
                "z": 1,
                "embeds": []
            },
            "0ddc44bd-8908-466d-a537-027a753764e2": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 750
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "f24b84fa-3da3-4a1b-ac9f-6f6a48e3032c"
                ]
            },
            "159928af-45b5-4fcd-a351-7715ef54a32a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 840,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "80510bb8-46a3-4bf7-8d76-bf652c7ae967": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 840,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "40fafa4d-591f-4540-9956-9958348b3522": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 840,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "cc90a2f6-21c3-4de6-9c53-d6025cf83afb": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 450
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "40fafa4d-591f-4540-9956-9958348b3522"
                ]
            },
            "9680a338-99bf-47e9-a840-4ae1147f82f3": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "82175c95-3c41-4d0f-b96e-c216a160016e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "75f3d336-f767-45f1-8b9b-b756fa18beb9": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 810
                },
                "z": 1,
                "embeds": []
            },
            "597ba104-f344-40f9-ad4d-3004ed39cdec": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 810
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "75f3d336-f767-45f1-8b9b-b756fa18beb9"
                ]
            },
            "6345eeed-8df1-4381-888d-e4f0f40af56e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 810
                },
                "z": 1,
                "embeds": []
            },
            "68f64c5b-8f55-4958-a6be-c97cdba9670e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 810
                },
                "z": 1,
                "embeds": []
            },
            "f4755dd5-be77-4bd1-a92b-b8cd5c70a182": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 810
                },
                "z": 1,
                "embeds": []
            },
            "f26b9194-d16c-450e-833b-0b3061a491ec": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 900,
                    "y": 450
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "f4755dd5-be77-4bd1-a92b-b8cd5c70a182"
                ]
            },
            "6179cde9-2d0a-4769-9b17-c7d3cee1908d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 900,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "6fa7ebbe-9e54-4249-873a-e43ec72d9275",
                    "a6204b71-dee6-4d80-a3f9-c19562fd2b9d",
                    "597ba104-f344-40f9-ad4d-3004ed39cdec",
                    "f26b9194-d16c-450e-833b-0b3061a491ec",
                    "cc90a2f6-21c3-4de6-9c53-d6025cf83afb",
                    "0ddc44bd-8908-466d-a537-027a753764e2",
                    "422743cb-47fa-421c-a59b-4a845d4e2ff4",
                    "14b55ae1-cdec-4eac-abcd-eb900a248c0e",
                    "1b8d4d1a-a3d7-4e42-9dca-95a8aae00eb3",
                    "5fdfeb99-32f1-4fca-b339-422f4766ce12"
                ]
            },
            "ebd5e1a0-65af-4368-8ea1-f23fcd303e57": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 900,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "af20d322-1cf6-4774-bc71-340a47d92b0b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 900,
                    "y": 810
                },
                "z": 1,
                "embeds": []
            },
            "033695e4-5166-4e30-9083-6abebbb0a672": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 870
                },
                "z": 1,
                "embeds": []
            },
            "0059fe1c-d7d3-4150-a336-c47cf692d360": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1290,
                    "y": 730
                },
                "z": 1,
                "embeds": []
            },
            "861f4e2b-0bfb-483e-909b-a16e0306106a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1420,
                    "y": 1140
                },
                "z": 1,
                "embeds": []
            },
            "9a0aa546-a93f-4752-8b3a-63e758bffcca": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1390,
                    "y": 810
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "0059fe1c-d7d3-4150-a336-c47cf692d360"
                ]
            },
            "b01a5931-fa3c-4a2a-93b5-83b4ada07c89": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 600,
                    "y": 940
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "033695e4-5166-4e30-9083-6abebbb0a672"
                ]
            },
            "1cce205c-1ee0-45bf-b227-4c67765fd7ff": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1580,
                    "y": 810
                },
                "z": 1,
                "embeds": []
            },
            "6cba43d7-5748-491b-9787-9a63680e040d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1490,
                    "y": 1000
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "9a0aa546-a93f-4752-8b3a-63e758bffcca"
                ]
            },
            "1914005c-8151-417b-87da-463322e97555": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 900,
                    "y": 930
                },
                "z": 1,
                "embeds": []
            },
            "e88a31bc-47d4-4113-9fdc-9f6fd09f49ab": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 960,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "a28ef1ea-d8f2-4f34-b7eb-d3feffa7d341": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 960,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "a5078c7c-6043-480b-b03a-228dd1009bcd": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 960,
                    "y": 330
                },
                "z": 1,
                "embeds": [],
                "dependson": [
                    "e88a31bc-47d4-4113-9fdc-9f6fd09f49ab"
                ]
            },
            "8a887d1e-39f4-42f3-ba33-49b6277b84f9": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1020,
                    "y": 450
                },
                "z": 1,
                "embeds": [],
                "dependson": [
                    "a28ef1ea-d8f2-4f34-b7eb-d3feffa7d341"
                ]
            },
            "e8948f9f-7b61-47f3-8cfa-1baca9ed6f6b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1020,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "908b31df-07e1-4714-8688-f039a57b3cdc": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1020,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "ecfdc397-0cb8-4142-9fea-178c09886c3d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1020,
                    "y": 810
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "908b31df-07e1-4714-8688-f039a57b3cdc"
                ]
            },
            "aeadf9d5-cb46-49e3-aa43-31b290333bca": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1020,
                    "y": 930
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "908b31df-07e1-4714-8688-f039a57b3cdc"
                ]
            },
            "c85674c8-9355-4617-a6f2-76a8f442a8e7": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 990
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "908b31df-07e1-4714-8688-f039a57b3cdc"
                ]
            },
            "370040df-d3f2-419f-9db8-8f9c29efde5a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 990
                },
                "z": 1,
                "embeds": []
            },
            "79237857-6d0d-4a94-8ad6-1c08de81445c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1080,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "1438bbb7-29cc-4b09-92f6-b3efd5daeb53": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1080,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "2e03b58e-cff5-4bd4-a32b-b88cc9652b70": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 60,
                    "y": 90
                },
                "z": 1,
                "embeds": [
                    "2203852e-140b-4a99-bbef-0f98fd7aaa45"
                ]
            },
            "388fe87f-7c4e-40d5-8211-0c746147402b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1130,
                    "y": 1000
                },
                "z": 1,
                "embeds": []
            },
            "78901633-db6e-4296-99ee-a276cfc26ee9": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1160,
                    "y": 680
                },
                "z": 1,
                "embeds": []
            },
            "2203852e-140b-4a99-bbef-0f98fd7aaa45": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 90,
                    "y": 150
                },
                "z": 2,
                "parent": "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                "embeds": [],
                "isassociatedwith": [
                    "78901633-db6e-4296-99ee-a276cfc26ee9"
                ],
                "iscontainedinside": [
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70",
                    "2e03b58e-cff5-4bd4-a32b-b88cc9652b70"
                ]
            },
            "3ea01e2e-8324-4129-aa8d-40d93e9e48ff": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 1050
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "388fe87f-7c4e-40d5-8211-0c746147402b"
                ]
            },
            "1b6331de-f8d1-4e22-a15d-049b15a9f5da": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 480,
                    "y": 1190
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "3ea01e2e-8324-4129-aa8d-40d93e9e48ff",
                    "861f4e2b-0bfb-483e-909b-a16e0306106a",
                    "8514e786-03f2-4ffb-9cfb-2f4098ea3af9"
                ]
            },
            "cf9224ff-334c-47d2-89b3-a7e46c6cd15c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 1050
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1b6331de-f8d1-4e22-a15d-049b15a9f5da"
                ]
            },
            "3e6cf6c6-3696-4f3e-8131-3597a0e65770": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 1050
                },
                "z": 1,
                "embeds": []
            },
            "9512e36a-aa62-442f-a462-d4ac83fa7d29": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 900,
                    "y": 1050
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1b6331de-f8d1-4e22-a15d-049b15a9f5da"
                ]
            },
            "213e74d5-ccf6-4193-8dbf-c9bf2ae5c2b4": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1020,
                    "y": 1050
                },
                "z": 1,
                "embeds": []
            },
            "76379d7c-fab0-4b35-b8f0-4b0f7817c340": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 1110
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1b6331de-f8d1-4e22-a15d-049b15a9f5da",
                    "79237857-6d0d-4a94-8ad6-1c08de81445c"
                ]
            },
            "dab79a93-6836-4fa7-8e67-9f81917e6959": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1730,
                    "y": 830
                },
                "z": 1,
                "embeds": []
            },
            "e07512b6-ca52-446b-bced-093669ad570f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1660,
                    "y": 1000
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "9a0aa546-a93f-4752-8b3a-63e758bffcca",
                    "fadb63fa-7693-49ed-a61b-c58a37014d4f"
                ]
            },
            "8514e786-03f2-4ffb-9cfb-2f4098ea3af9": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1550,
                    "y": 1140
                },
                "z": 1,
                "embeds": []
            },
            "fadb63fa-7693-49ed-a61b-c58a37014d4f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1390,
                    "y": 910
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "0059fe1c-d7d3-4150-a336-c47cf692d360"
                ]
            }
        }
    },
    "Conditions": {
        "isRegional": {
            "Fn::Equals": [
                {
                    "Ref": "stackScope"
                },
                "Regional"
            ]
        },
        "isGlobal": {
            "Fn::Equals": [
                {
                    "Ref": "stackScope"
                },
                "Global"
            ]
        }
    },
    "Resources": {
        "WebServerSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupName": "csye6225-webapp",
                "GroupDescription": "access for port 80 from load balancer",
                "VpcId": {
                    "Ref": "VpcID"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "80",
                        "ToPort": "80",
                        "SourceSecurityGroupId": {
                            "Ref": "LBSecurityGroup"
                        }
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "csye6225-WebAppSecurityGroup"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "388fe87f-7c4e-40d5-8211-0c746147402b"
                }
            }
        },
        "DBServerSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupName": "csye6225-rds",
                "GroupDescription": "Allowing traffic to port 3306",
                "VpcId": {
                    "Ref": "VpcID"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 3306,
                        "ToPort": 3306,
                        "SourceSecurityGroupId": {
                            "Ref": "WebServerSecurityGroup"
                        }
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "csye6225-DBSecurityGroup"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "78901633-db6e-4296-99ee-a276cfc26ee9"
                }
            }
        },
        "RDSSubnetGroup": {
            "Type": "AWS::RDS::DBSubnetGroup",
            "Properties": {
                "DBSubnetGroupDescription": "Subnet group for RDS Instances",
                "SubnetIds": [
                    {
                        "Ref": "PublicSubnetKey1"
                    },
                    {
                        "Ref": "PublicSubnetKey2"
                    },
                    {
                        "Ref": "PublicSubnetKey3"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "csye6225-RDSSubnetGroup"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "2e03b58e-cff5-4bd4-a32b-b88cc9652b70"
                }
            }
        },
        "RDSInstance": {
            "Type": "AWS::RDS::DBInstance",
            "Properties": {
                "DBName": "csye6225",
                "AllocatedStorage": "100",
                "DBInstanceClass": "db.t2.medium",
                "Engine": "MySQL",
                "MasterUsername": "csye6225master",
                "MasterUserPassword": "csye6225password",
                "MultiAZ": false,
                "DBInstanceIdentifier": "csye6225-spring2019",
                "PubliclyAccessible": true,
                "Port": "3306",
                "DBSubnetGroupName": {
                    "Ref": "RDSSubnetGroup"
                },
                "VPCSecurityGroups": [
                    {
                        "Ref": "DBServerSecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "csye6225-RDSInstance"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "2203852e-140b-4a99-bbef-0f98fd7aaa45"
                }
            }
        },
        "DynamoDBTable": {
            "Type": "AWS::DynamoDB::Table",
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": "Id",
                        "AttributeType": "S"
                    },
                    {
                        "AttributeName": "Email",
                        "AttributeType": "S"
                    }
                ],
                "KeySchema": [
                    {
                        "AttributeName": "Id",
                        "KeyType": "HASH"
                    },
                    {
                        "AttributeName": "Email",
                        "KeyType": "RANGE"
                    }
                ],
                "ProvisionedThroughput": {
                    "ReadCapacityUnits": "1",
                    "WriteCapacityUnits": "1"
                },
                "TableName": "csye6225",
                "TimeToLiveSpecification": {
                    "AttributeName": "ExpireTime",
                    "Enabled": "TRUE"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": "csye6225-DynamoDBTable"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1438bbb7-29cc-4b09-92f6-b3efd5daeb53"
                }
            }
        },
        "CodeDeployApplication": {
            "Type": "AWS::CodeDeploy::Application",
            "Properties": {
                "ApplicationName": "csye6225-webapp",
                "ComputePlatform": "Server"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "79237857-6d0d-4a94-8ad6-1c08de81445c"
                }
            }
        },
        "CodeDeployDeploymentGroup": {
            "Type": "AWS::CodeDeploy::DeploymentGroup",
            "Properties": {
                "ApplicationName": {
                    "Ref": "CodeDeployApplication"
                },
                "DeploymentGroupName": "csye6225-webapp-deployment",
                "ServiceRoleArn": {
                    "Fn::GetAtt": [
                        "CodeDeployServiceRole",
                        "Arn"
                    ]
                },
                "DeploymentStyle": {
                    "DeploymentOption": "WITHOUT_TRAFFIC_CONTROL",
                    "DeploymentType": "IN_PLACE"
                },
                "DeploymentConfigName": "CodeDeployDefault.AllAtOnce",
                "AutoRollbackConfiguration": {
                    "Enabled": "true",
                    "Events": [
                        "DEPLOYMENT_FAILURE"
                    ]
                },
                "AutoScalingGroups": [
                    {
                        "Ref": "AutoScalingGroup"
                    }
                ],
                "Ec2TagFilters": [
                    {
                        "Key": "CodeDeployTag",
                        "Type": "KEY_AND_VALUE",
                        "Value": "Deploy"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "76379d7c-fab0-4b35-b8f0-4b0f7817c340"
                }
            }
        },
        "CodeDeployServiceRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": "CodeDeployServiceRole",
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "codedeploy.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "Path": "/",
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AWSCodeDeployRole"
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "370040df-d3f2-419f-9db8-8f9c29efde5a"
                }
            }
        },
        "CodeDeployEC2S3": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "CodeDeploy-EC2-S3",
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "s3:ListBucketByTags",
                                "s3:GetLifecycleConfiguration",
                                "s3:GetBucketTagging",
                                "s3:GetInventoryConfiguration",
                                "s3:GetObjectVersionTagging",
                                "s3:ListBucketVersions",
                                "s3:GetBucketLogging",
                                "s3:ListBucket",
                                "s3:GetAccelerateConfiguration",
                                "s3:GetBucketPolicy",
                                "s3:GetObjectVersionTorrent",
                                "s3:GetObjectAcl",
                                "s3:GetEncryptionConfiguration",
                                "s3:GetBucketRequestPayment",
                                "s3:GetObjectVersionAcl",
                                "s3:GetObjectTagging",
                                "s3:GetMetricsConfiguration",
                                "s3:GetBucketPublicAccessBlock",
                                "s3:GetBucketPolicyStatus",
                                "s3:ListBucketMultipartUploads",
                                "s3:GetBucketWebsite",
                                "s3:GetBucketVersioning",
                                "s3:GetBucketAcl",
                                "s3:GetBucketNotification",
                                "s3:GetReplicationConfiguration",
                                "s3:ListMultipartUploadParts",
                                "s3:GetObject",
                                "s3:GetObjectTorrent",
                                "s3:GetBucketCORS",
                                "s3:GetAnalyticsConfiguration",
                                "s3:GetObjectVersionForReplication",
                                "s3:GetBucketLocation",
                                "s3:GetObjectVersion"
                            ],
                            "Resource": [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "arn:aws:s3:::",
                                            {
                                                "Ref": "S3CDBucket"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "arn:aws:s3:::",
                                            {
                                                "Ref": "S3CDBucket"
                                            },
                                            "/*"
                                        ]
                                    ]
                                }
                            ]
                        },
                        {
                            "Effect": "Allow",
                            "Action": [
                                "s3:GetAccountPublicAccessBlock",
                                "s3:ListAllMyBuckets",
                                "s3:HeadBucket"
                            ],
                            "Resource": "*"
                        }
                    ]
                },
                "Roles": [
                    {
                        "Ref": "CodeDeployEC2ServiceRole"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "c85674c8-9355-4617-a6f2-76a8f442a8e7"
                }
            }
        },
        "CodeDeployEC2InstanceProfile": {
            "Type": "AWS::IAM::InstanceProfile",
            "Properties": {
                "Path": "/",
                "Roles": [
                    {
                        "Ref": "CodeDeployEC2ServiceRole"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "aeadf9d5-cb46-49e3-aa43-31b290333bca"
                }
            }
        },
        "CodeDeployEC2ServiceRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": "CodeDeployEC2ServiceRole",
                "Path": "/",
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "ec2.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy",
                    "arn:aws:iam::aws:policy/AmazonSNSFullAccess"
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "908b31df-07e1-4714-8688-f039a57b3cdc"
                }
            }
        },
        "UploadS3": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "UploadS3",
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "s3:PutObject",
                                "s3:DeleteObject",
                                "s3:PutObjectAcl"
                            ],
                            "Resource": [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "arn:aws:s3:::",
                                            {
                                                "Ref": "S3UploadBucket"
                                            },
                                            "/*"
                                        ]
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "Roles": [
                    {
                        "Ref": "CodeDeployEC2ServiceRole"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ecfdc397-0cb8-4142-9fea-178c09886c3d"
                }
            }
        },
        "circleciUploadToS3": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "s3:PutObject"
                            ],
                            "Resource": [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "arn:aws:s3:::",
                                            {
                                                "Ref": "S3CDBucket"
                                            },
                                            "/*"
                                        ]
                                    ]
                                }
                            ]
                        },
                        {
                            "Effect": "Allow",
                            "Action": "route53:*",
                            "Resource": "*"
                        }
                    ]
                },
                "PolicyName": "circleciUploadToS3",
                "Users": [
                    "circleci"
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "e8948f9f-7b61-47f3-8cfa-1baca9ed6f6b"
                }
            }
        },
        "SNSReset": {
            "Type": "AWS::SNS::Topic",
            "Properties": {
                "TopicName": "SNSReset"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a28ef1ea-d8f2-4f34-b7eb-d3feffa7d341"
                }
            }
        },
        "LambdaReset": {
            "Type": "AWS::Lambda::Function",
            "Properties": {
                "FunctionName": "LambdaReset",
                "Handler": "SNSHandler::handleRequest",
                "Code": {
                    "S3Bucket": {
                        "Ref": "S3CDBucket"
                    },
                    "S3Key": "csye6225-spring2019-lambda-1.0-SNAPSHOT.jar"
                },
                "Environment": {
                    "Variables": {
                        "FROM": {
                            "Ref": "Domain"
                        },
                        "timeToLive": "20"
                    }
                },
                "Role": {
                    "Fn::GetAtt": [
                        "IAMLambdaRole",
                        "Arn"
                    ]
                },
                "Runtime": "java8",
                "Timeout": 300,
                "MemorySize": 256
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "e88a31bc-47d4-4113-9fdc-9f6fd09f49ab"
                }
            }
        },
        "IAMLambdaRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": "IAMLambdaRole",
                "Path": "/",
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "lambda.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/AmazonSESFullAccess",
                    "arn:aws:iam::aws:policy/AmazonDynamoDBFullAccesswithDataPipeline",
                    "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1914005c-8151-417b-87da-463322e97555"
                }
            }
        },
        "SNSsub": {
            "Type": "AWS::SNS::Subscription",
            "Properties": {
                "TopicArn": {
                    "Ref": "SNSReset"
                },
                "Endpoint": {
                    "Fn::GetAtt": [
                        "LambdaReset",
                        "Arn"
                    ]
                },
                "Protocol": "lambda"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8a887d1e-39f4-42f3-ba33-49b6277b84f9"
                }
            },
            "DependsOn": [
                "SNSReset",
                "LambdaReset"
            ]
        },
        "LambdaPermission": {
            "Type": "AWS::Lambda::Permission",
            "Properties": {
                "Action": "lambda:InvokeFunction",
                "Principal": "sns.amazonaws.com",
                "SourceArn": {
                    "Ref": "SNSReset"
                },
                "FunctionName": {
                    "Fn::GetAtt": [
                        "LambdaReset",
                        "Arn"
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a5078c7c-6043-480b-b03a-228dd1009bcd"
                }
            },
            "DependsOn": [
                "LambdaReset",
                "SNSReset"
            ]
        },
        "LaunchConfiguration": {
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": {
                "ImageId": {
                    "Ref": "ImageID"
                },
                "InstanceType": "t2.micro",
                "KeyName": {
                    "Ref": "KeyName"
                },
                "AssociatePublicIpAddress": true,
                "IamInstanceProfile": {
                    "Ref": "CodeDeployEC2InstanceProfile"
                },
                "LaunchConfigurationName": "asg_launch_config",
                "SecurityGroups": [
                    {
                        "Ref": "WebServerSecurityGroup"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                "#!/bin/bash -xe ",
                                "sudo service codedeploy-agent start",
                                "sudo -s",
                                "echo '#!/bin/bash' >> /home/centos/vars.sh",
                                "cd /home/centos/",
                                "chmod +x ./vars.sh",
                                "echo -n 'java -jar springbootdemo-0.0.1-SNAPSHOT.jar --spring.datasource.username=csye6225master --spring.datasourse.password=csye6225password --spring.profiles.active=dev' >> /home/centos/vars.sh",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo -n ' --spring.datasource.url=jdbc:mysql://",
                                            {
                                                "Fn::GetAtt": [
                                                    "RDSInstance",
                                                    "Endpoint.Address"
                                                ]
                                            },
                                            ":3306/csye6225' >> /home/centos/vars.sh"
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo -n ' --aws.sns.topic.ARN=arn:aws:sns:",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            ":",
                                            {
                                                "Ref": "AWS::AccountId"
                                            },
                                            ":SNSReset' >> /home/centos/vars.sh"
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo ' --aws.s3.audio.bucket=",
                                            {
                                                "Ref": "S3UploadBucket"
                                            },
                                            "' >> /home/centos/vars.sh"
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "3ea01e2e-8324-4129-aa8d-40d93e9e48ff"
                }
            }
        },
        "AutoScalingGroup": {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": {
                "Cooldown": "60",
                "LaunchConfigurationName": {
                    "Ref": "LaunchConfiguration"
                },
                "MinSize": "3",
                "MaxSize": "10",
                "DesiredCapacity": "3",
                "VPCZoneIdentifier": [
                    {
                        "Ref": "PublicSubnetKey1"
                    },
                    {
                        "Ref": "PublicSubnetKey2"
                    },
                    {
                        "Ref": "PublicSubnetKey3"
                    }
                ],
                "TargetGroupARNs": [
                    {
                        "Ref": "ALBTargetGroup"
                    },
                    {
                        "Ref": "ALBTargetGroupNoWAF"
                    }
                ],
                "Tags": [
                    {
                        "Key": "CodeDeployTag",
                        "Value": "Deploy",
                        "PropagateAtLaunch": true
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1b6331de-f8d1-4e22-a15d-049b15a9f5da"
                }
            }
        },
        "WebServerScaleUpPolicy": {
            "Type": "AWS::AutoScaling::ScalingPolicy",
            "Properties": {
                "AdjustmentType": "ChangeInCapacity",
                "AutoScalingGroupName": {
                    "Ref": "AutoScalingGroup"
                },
                "Cooldown": "60",
                "ScalingAdjustment": "1"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9512e36a-aa62-442f-a462-d4ac83fa7d29"
                }
            }
        },
        "WebServerScaleDownPolicy": {
            "Type": "AWS::AutoScaling::ScalingPolicy",
            "Properties": {
                "AdjustmentType": "ChangeInCapacity",
                "AutoScalingGroupName": {
                    "Ref": "AutoScalingGroup"
                },
                "Cooldown": "60",
                "ScalingAdjustment": "-1"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "cf9224ff-334c-47d2-89b3-a7e46c6cd15c"
                }
            }
        },
        "CPUAlarmHigh": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmDescription": "Scale-up if CPU > 10% for 10 minutes",
                "MetricName": "CPUUtilization",
                "Namespace": "AWS/EC2",
                "Statistic": "Average",
                "Period": "300",
                "EvaluationPeriods": "2",
                "Threshold": "10",
                "AlarmActions": [
                    {
                        "Ref": "WebServerScaleUpPolicy"
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "AutoScalingGroupName",
                        "Value": {
                            "Ref": "AutoScalingGroup"
                        }
                    }
                ],
                "ComparisonOperator": "GreaterThanThreshold"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "213e74d5-ccf6-4193-8dbf-c9bf2ae5c2b4"
                }
            }
        },
        "CPUAlarmLow": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmDescription": "Scale-down if CPU < 5% for 10 minutes",
                "MetricName": "CPUUtilization",
                "Namespace": "AWS/EC2",
                "Statistic": "Average",
                "Period": "300",
                "EvaluationPeriods": "2",
                "Threshold": "5",
                "AlarmActions": [
                    {
                        "Ref": "WebServerScaleDownPolicy"
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "AutoScalingGroupName",
                        "Value": {
                            "Ref": "AutoScalingGroup"
                        }
                    }
                ],
                "ComparisonOperator": "LessThanThreshold"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "3e6cf6c6-3696-4f3e-8131-3597a0e65770"
                }
            }
        },
        "ApplicationLoadBalancer": {
            "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
            "Properties": {
                "Subnets": [
                    {
                        "Ref": "PublicSubnetKey1"
                    },
                    {
                        "Ref": "PublicSubnetKey2"
                    },
                    {
                        "Ref": "PublicSubnetKey3"
                    }
                ],
                "SecurityGroups": [
                    {
                        "Ref": "LBSecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9a0aa546-a93f-4752-8b3a-63e758bffcca"
                }
            }
        },
        "ALBTargetGroup": {
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": {
                "Port": 80,
                "Protocol": "HTTP",
                "VpcId": {
                    "Ref": "VpcID"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "861f4e2b-0bfb-483e-909b-a16e0306106a"
                }
            }
        },
        "ALBListener": {
            "Type": "AWS::ElasticLoadBalancingV2::Listener",
            "Properties": {
                "DefaultActions": [
                    {
                        "Type": "forward",
                        "TargetGroupArn": {
                            "Ref": "ALBTargetGroup"
                        }
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "ApplicationLoadBalancer"
                },
                "Port": "443",
                "Protocol": "HTTPS",
                "Certificates": [
                    {
                        "CertificateArn": {
                            "Ref": "certificateARN"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6cba43d7-5748-491b-9787-9a63680e040d"
                }
            }
        },
        "LBSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupName": "csye6225-LB",
                "GroupDescription": "access for port 443 (https default) from anywhere",
                "VpcId": {
                    "Ref": "VpcID"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": "0.0.0.0/0"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0059fe1c-d7d3-4150-a336-c47cf692d360"
                }
            }
        },
        "AliasRecordSetGroup": {
            "Type": "AWS::Route53::RecordSetGroup",
            "Properties": {
                "HostedZoneName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Domain"
                            },
                            "."
                        ]
                    ]
                },
                "Comment": "alias record for ELB",
                "RecordSets": [
                    {
                        "Name": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Ref": "Domain"
                                    },
                                    "."
                                ]
                            ]
                        },
                        "Type": "A",
                        "AliasTarget": {
                            "HostedZoneId": {
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancer",
                                    "CanonicalHostedZoneID"
                                ]
                            },
                            "DNSName": {
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancer",
                                    "DNSName"
                                ]
                            }
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1cce205c-1ee0-45bf-b227-4c67765fd7ff"
                }
            }
        },
        "wafrSQLiSet": {
            "Type": "AWS::WAFRegional::SqlInjectionMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-sqli"
                        ]
                    ]
                },
                "SqlInjectionMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ebd5e1a0-65af-4368-8ea1-f23fcd303e57"
                }
            }
        },
        "wafgSQLiSet": {
            "Type": "AWS::WAF::SqlInjectionMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-sqli"
                        ]
                    ]
                },
                "SqlInjectionMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f4755dd5-be77-4bd1-a92b-b8cd5c70a182"
                }
            }
        },
        "wafrSQLiRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigatesqli"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigate-sqli"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "SqlInjectionMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrSQLiSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "af20d322-1cf6-4774-bc71-340a47d92b0b"
                }
            }
        },
        "wafgSQLiRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigatesqli"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigate-sqli"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "SqlInjectionMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgSQLiSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f26b9194-d16c-450e-833b-0b3061a491ec"
                }
            }
        },
        "wafrAuthTokenStringSet": {
            "Type": "AWS::WAFRegional::ByteMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-auth-tokens"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "example-session-id",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "authorization"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ",
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6345eeed-8df1-4381-888d-e4f0f40af56e"
                }
            }
        },
        "wafgAuthTokenStringSet": {
            "Type": "AWS::WAF::ByteMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-auth-tokens"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "example-session-id",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "authorization"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ",
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "75f3d336-f767-45f1-8b9b-b756fa18beb9"
                }
            }
        },
        "wafrAuthTokenRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "badauthtokens"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-bad-auth-tokens"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrAuthTokenStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "68f64c5b-8f55-4958-a6be-c97cdba9670e"
                }
            }
        },
        "wafgAuthTokenRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "badauthtokens"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-bad-auth-tokens"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgAuthTokenStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "597ba104-f344-40f9-ad4d-3004ed39cdec"
                }
            }
        },
        "wafrXSSSet": {
            "Type": "AWS::WAFRegional::XssMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-xss"
                        ]
                    ]
                },
                "XssMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9680a338-99bf-47e9-a840-4ae1147f82f3"
                }
            }
        },
        "wafgXSSSet": {
            "Type": "AWS::WAF::XssMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-xss"
                        ]
                    ]
                },
                "XssMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "40fafa4d-591f-4540-9956-9958348b3522"
                }
            }
        },
        "wafrXSSRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigatexss"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigate-xss"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "XssMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrXSSSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "82175c95-3c41-4d0f-b96e-c216a160016e"
                }
            }
        },
        "wafgXSSRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigatexss"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "mitigate-xss"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "XssMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgXSSSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "cc90a2f6-21c3-4de6-9c53-d6025cf83afb"
                }
            }
        },
        "wafrPathsStringSet": {
            "Type": "AWS::WAFRegional::ByteMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-rfi-lfi-traversal"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "159928af-45b5-4fcd-a351-7715ef54a32a"
                }
            }
        },
        "wafgPathsStringSet": {
            "Type": "AWS::WAF::ByteMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-rfi-lfi-traversal"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "../",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "://",
                        "TextTransformation": "HTML_ENTITY_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f24b84fa-3da3-4a1b-ac9f-6f6a48e3032c"
                }
            }
        },
        "wafrPathsRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectrfilfi"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-rfi-lfi-traversal"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrPathsStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "80510bb8-46a3-4bf7-8d76-bf652c7ae967"
                }
            }
        },
        "wafgPathsRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectrfilfi"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-rfi-lfi-traversal"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgPathsStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0ddc44bd-8908-466d-a537-027a753764e2"
                }
            }
        },
        "wafrAdminUrlStringSet": {
            "Type": "AWS::WAFRegional::ByteMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-admin-url"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "STARTS_WITH",
                        "TargetString": {
                            "Ref": "adminUrlPrefix"
                        },
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ba148479-6b59-4a75-9fa5-f7ddc060978b"
                }
            }
        },
        "wafgAdminUrlStringSet": {
            "Type": "AWS::WAF::ByteMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-admin-url"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "STARTS_WITH",
                        "TargetString": {
                            "Ref": "adminUrlPrefix"
                        },
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4c9c1a5e-3021-4f61-b415-c16d1ddfba47"
                }
            }
        },
        "wafrAdminRemoteAddrIpSet": {
            "Type": "AWS::WAFRegional::IPSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-admin-remote-ip"
                        ]
                    ]
                },
                "IPSetDescriptors": [
                    {
                        "Type": "IPV4",
                        "Value": {
                            "Ref": "adminRemoteCidr"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "337679ee-801b-45c2-be04-173d80315c36"
                }
            }
        },
        "wafgAdminRemoteAddrIpSet": {
            "Type": "AWS::WAF::IPSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-admin-remote-ip"
                        ]
                    ]
                },
                "IPSetDescriptors": [
                    {
                        "Type": "IPV4",
                        "Value": {
                            "Ref": "adminRemoteCidr"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "5d36b19e-1817-4edf-9964-80ecae53cae4"
                }
            }
        },
        "wafrAdminAccessRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectadminaccess"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-admin-access"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrAdminUrlStringSet"
                        }
                    },
                    {
                        "Type": "IPMatch",
                        "Negated": true,
                        "DataId": {
                            "Ref": "wafrAdminRemoteAddrIpSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "26770ce2-1075-49c4-8157-97507fc57eb8"
                }
            }
        },
        "wafgAdminAccessRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectadminaccess"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-admin-access"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgAdminUrlStringSet"
                        }
                    },
                    {
                        "Type": "IPMatch",
                        "Negated": true,
                        "DataId": {
                            "Ref": "wafgAdminRemoteAddrIpSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "5fdfeb99-32f1-4fca-b339-422f4766ce12"
                }
            }
        },
        "wafrPHPInsecureQSStringSet": {
            "Type": "AWS::WAFRegional::ByteMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-php-insecure-var-refs"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "_SERVER[",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "_ENV[",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "auto_prepend_file=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "auto_append_file=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "allow_url_include=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "disable_functions=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "open_basedir=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "safe_mode=",
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "be92c255-8d67-44d5-acf1-9d64226f9235"
                }
            }
        },
        "wafgPHPInsecureQSStringSet": {
            "Type": "AWS::WAF::ByteMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-php-insecure-var-refs"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "_SERVER[",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "_ENV[",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "auto_prepend_file=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "auto_append_file=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "allow_url_include=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "disable_functions=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "open_basedir=",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "PositionalConstraint": "CONTAINS",
                        "TargetString": "safe_mode=",
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8fcdb0db-501a-4e8c-924b-e80c1b8ac849"
                }
            }
        },
        "wafrPHPInsecureURIStringSet": {
            "Type": "AWS::WAFRegional::ByteMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-php-insecure-uri"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": "php",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": "/",
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4502d546-8948-490c-9291-470540e4d3e8"
                }
            }
        },
        "wafgPHPInsecureURIStringSet": {
            "Type": "AWS::WAF::ByteMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-php-insecure-uri"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": "php",
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": "/",
                        "TextTransformation": "URL_DECODE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b8ad925e-e972-4215-8ff8-f7e20ca765c6"
                }
            }
        },
        "wafrPHPInsecureRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectphpinsecure"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-php-insecure"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrPHPInsecureQSStringSet"
                        }
                    },
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrPHPInsecureURIStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "655821ea-6dfc-4a68-bd37-52acaab07968"
                }
            }
        },
        "wafgPHPInsecureRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectphpinsecure"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-php-insecure"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgPHPInsecureQSStringSet"
                        }
                    },
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgPHPInsecureURIStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "422743cb-47fa-421c-a59b-4a845d4e2ff4"
                }
            }
        },
        "wafrSizeRestrictionSet": {
            "Type": "AWS::WAFRegional::SizeConstraintSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "size-restrictions"
                        ]
                    ]
                },
                "SizeConstraints": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedURISize"
                        }
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedQueryStringSize"
                        }
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedBodySize"
                        }
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedCookieSize"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "aea99dd6-97d5-42df-a4e0-9e94de92485a"
                }
            }
        },
        "wafgSizeRestrictionSet": {
            "Type": "AWS::WAF::SizeConstraintSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "size-restrictions"
                        ]
                    ]
                },
                "SizeConstraints": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedURISize"
                        }
                    },
                    {
                        "FieldToMatch": {
                            "Type": "QUERY_STRING"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedQueryStringSize"
                        }
                    },
                    {
                        "FieldToMatch": {
                            "Type": "BODY"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedBodySize"
                        }
                    },
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": "cookie"
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "GT",
                        "Size": {
                            "Ref": "maxExpectedCookieSize"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "48ce54ea-e507-407c-ab74-39d93f716061"
                }
            }
        },
        "wafrSizeRestrictionRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "restrictsizes"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "restrict-sizes"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "SizeConstraint",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrSizeRestrictionSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "235054b3-99cf-468c-a227-4f1fe0773b43"
                }
            }
        },
        "wafgSizeRestrictionRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "restrictsizes"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "restrict-sizes"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "SizeConstraint",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgSizeRestrictionSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6fa7ebbe-9e54-4249-873a-e43ec72d9275"
                }
            }
        },
        "wafrCSRFMethodStringSet": {
            "Type": "AWS::WAFRegional::ByteMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-csrf-method"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "METHOD"
                        },
                        "PositionalConstraint": "EXACTLY",
                        "TargetString": "TBD",
                        "TextTransformation": "LOWERCASE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "44d8b0e1-c5bc-4247-8efa-30005af35691"
                }
            }
        },
        "wafgCSRFMethodStringSet": {
            "Type": "AWS::WAF::ByteMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-csrf-method"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "METHOD"
                        },
                        "PositionalConstraint": "EXACTLY",
                        "TargetString": "TBD",
                        "TextTransformation": "LOWERCASE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0203efb8-0b45-4c34-bf29-f18d6f92d2ad"
                }
            }
        },
        "wafrCSRFTokenSizeConstraint": {
            "Type": "AWS::WAFRegional::SizeConstraintSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-csrf-token"
                        ]
                    ]
                },
                "SizeConstraints": [
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": {
                                "Ref": "csrfExpectedHeader"
                            }
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "EQ",
                        "Size": {
                            "Ref": "csrfExpectedSize"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "2f0bd676-3f4d-45c3-9b73-312436e08416"
                }
            }
        },
        "wafgCSRFTokenSizeConstraint": {
            "Type": "AWS::WAF::SizeConstraintSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-csrf-token"
                        ]
                    ]
                },
                "SizeConstraints": [
                    {
                        "FieldToMatch": {
                            "Type": "HEADER",
                            "Data": {
                                "Ref": "csrfExpectedHeader"
                            }
                        },
                        "TextTransformation": "NONE",
                        "ComparisonOperator": "EQ",
                        "Size": {
                            "Ref": "csrfExpectedSize"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7391a19a-be13-442f-beeb-d17b439cce4a"
                }
            }
        },
        "wafrCSRFRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "enforcecsrf"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "enforce-csrf"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrCSRFMethodStringSet"
                        }
                    },
                    {
                        "Type": "SizeConstraint",
                        "Negated": true,
                        "DataId": {
                            "Ref": "wafrCSRFTokenSizeConstraint"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6dfd967c-870d-45f4-b027-2622e025bc90"
                }
            }
        },
        "wafgCSRFRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "enforcecsrf"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "enforce-csrf"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgCSRFMethodStringSet"
                        }
                    },
                    {
                        "Type": "SizeConstraint",
                        "Negated": true,
                        "DataId": {
                            "Ref": "wafgCSRFTokenSizeConstraint"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "14b55ae1-cdec-4eac-abcd-eb900a248c0e"
                }
            }
        },
        "wafrServerSideIncludeStringSet": {
            "Type": "AWS::WAFRegional::ByteMatchSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-ssi"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "STARTS_WITH",
                        "TargetString": {
                            "Ref": "includesPrefix"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".cfg",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".conf",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".config",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".ini",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".log",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".bak",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".backup",
                        "TextTransformation": "LOWERCASE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "756988d9-a264-4226-9208-10be616ca979"
                }
            }
        },
        "wafgServerSideIncludeStringSet": {
            "Type": "AWS::WAF::ByteMatchSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-ssi"
                        ]
                    ]
                },
                "ByteMatchTuples": [
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "STARTS_WITH",
                        "TargetString": {
                            "Ref": "includesPrefix"
                        },
                        "TextTransformation": "URL_DECODE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".cfg",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".conf",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".config",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".ini",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".log",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".bak",
                        "TextTransformation": "LOWERCASE"
                    },
                    {
                        "FieldToMatch": {
                            "Type": "URI"
                        },
                        "PositionalConstraint": "ENDS_WITH",
                        "TargetString": ".backup",
                        "TextTransformation": "LOWERCASE"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "346ce274-6cc7-4d17-b8fe-735207ce9f17"
                }
            }
        },
        "wafrServerSideIncludeRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectssi"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-ssi"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrServerSideIncludeStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "3ff95f6c-f4aa-4cc1-a977-e830e7ff177d"
                }
            }
        },
        "wafgServerSideIncludeRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detectssi"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-ssi"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "ByteMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgServerSideIncludeStringSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1b8d4d1a-a3d7-4e42-9dca-95a8aae00eb3"
                }
            }
        },
        "wafrBlacklistIpSet": {
            "Type": "AWS::WAFRegional::IPSet",
            "Condition": "isRegional",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-blacklisted-ips"
                        ]
                    ]
                },
                "IPSetDescriptors": [
                    {
                        "Type": "IPV4",
                        "Value": "10.0.0.0/8"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "192.168.0.0/16"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "169.254.0.0/16"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "172.16.0.0/16"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "127.0.0.1/32"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "3397aaba-35d9-406a-81ae-247e7ec8060b"
                }
            }
        },
        "wafgBlacklistIpSet": {
            "Type": "AWS::WAF::IPSet",
            "Condition": "isGlobal",
            "Properties": {
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "match-blacklisted-ips"
                        ]
                    ]
                },
                "IPSetDescriptors": [
                    {
                        "Type": "IPV4",
                        "Value": "10.0.0.0/8"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "192.168.0.0/16"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "169.254.0.0/16"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "172.16.0.0/16"
                    },
                    {
                        "Type": "IPV4",
                        "Value": "127.0.0.1/32"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "da80931f-bd6d-4a5b-a8cb-aa1df35d01a5"
                }
            }
        },
        "wafrBlacklistIpRule": {
            "Type": "AWS::WAFRegional::Rule",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "blacklistedips"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-blacklisted-ips"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "IPMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafrBlacklistIpSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "161434a6-6b19-4347-aee2-8e8f89edd24f"
                }
            }
        },
        "wafgBlacklistIpRule": {
            "Type": "AWS::WAF::Rule",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "blacklistedips"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "detect-blacklisted-ips"
                        ]
                    ]
                },
                "Predicates": [
                    {
                        "Type": "IPMatch",
                        "Negated": false,
                        "DataId": {
                            "Ref": "wafgBlacklistIpSet"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a6204b71-dee6-4d80-a3f9-c19562fd2b9d"
                }
            }
        },
        "wafrOwaspACL": {
            "Type": "AWS::WAFRegional::WebACL",
            "Condition": "isRegional",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "owaspacl"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "owasp-acl"
                        ]
                    ]
                },
                "DefaultAction": {
                    "Type": "ALLOW"
                },
                "Rules": [
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 10,
                        "RuleId": {
                            "Ref": "wafrSizeRestrictionRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 20,
                        "RuleId": {
                            "Ref": "wafrBlacklistIpRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 30,
                        "RuleId": {
                            "Ref": "wafrAuthTokenRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 40,
                        "RuleId": {
                            "Ref": "wafrSQLiRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 50,
                        "RuleId": {
                            "Ref": "wafrXSSRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 60,
                        "RuleId": {
                            "Ref": "wafrPathsRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 70,
                        "RuleId": {
                            "Ref": "wafrPHPInsecureRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 80,
                        "RuleId": {
                            "Ref": "wafrCSRFRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 90,
                        "RuleId": {
                            "Ref": "wafrServerSideIncludeRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 100,
                        "RuleId": {
                            "Ref": "wafrAdminAccessRule"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "033695e4-5166-4e30-9083-6abebbb0a672"
                }
            }
        },
        "wafgOwaspACL": {
            "Type": "AWS::WAF::WebACL",
            "Condition": "isGlobal",
            "Properties": {
                "MetricName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "owaspacl"
                        ]
                    ]
                },
                "Name": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "stackPrefix"
                            },
                            "owasp-acl"
                        ]
                    ]
                },
                "DefaultAction": {
                    "Type": "ALLOW"
                },
                "Rules": [
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 10,
                        "RuleId": {
                            "Ref": "wafgSizeRestrictionRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 20,
                        "RuleId": {
                            "Ref": "wafgBlacklistIpRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 30,
                        "RuleId": {
                            "Ref": "wafgAuthTokenRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 40,
                        "RuleId": {
                            "Ref": "wafgSQLiRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 50,
                        "RuleId": {
                            "Ref": "wafgXSSRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 60,
                        "RuleId": {
                            "Ref": "wafgPathsRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 70,
                        "RuleId": {
                            "Ref": "wafgPHPInsecureRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 80,
                        "RuleId": {
                            "Ref": "wafgCSRFRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 90,
                        "RuleId": {
                            "Ref": "wafgServerSideIncludeRule"
                        }
                    },
                    {
                        "Action": {
                            "Type": {
                                "Ref": "ruleAction"
                            }
                        },
                        "Priority": 100,
                        "RuleId": {
                            "Ref": "wafgAdminAccessRule"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6179cde9-2d0a-4769-9b17-c7d3cee1908d"
                }
            }
        },
        "WebACLAssociationELB": {
            "Type": "AWS::WAFRegional::WebACLAssociation",
            "Properties": {
                "ResourceArn": {
                    "Ref": "ApplicationLoadBalancer"
                },
                "WebACLId": {
                    "Ref": "wafrOwaspACL"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b01a5931-fa3c-4a2a-93b5-83b4ada07c89"
                }
            }
        },
        "AliasRecordSetGroupNoWAF": {
            "Type": "AWS::Route53::RecordSetGroup",
            "Properties": {
                "HostedZoneName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Domain"
                            },
                            "."
                        ]
                    ]
                },
                "Comment": "alias record for ELB NoWAF",
                "RecordSets": [
                    {
                        "Name": {
                            "Fn::Join": [
                                "",
                                [
                                    "nowaf.",
                                    {
                                        "Ref": "Domain"
                                    },
                                    "."
                                ]
                            ]
                        },
                        "Type": "A",
                        "AliasTarget": {
                            "HostedZoneId": {
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancerNoWAF",
                                    "CanonicalHostedZoneID"
                                ]
                            },
                            "DNSName": {
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancerNoWAF",
                                    "DNSName"
                                ]
                            }
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "dab79a93-6836-4fa7-8e67-9f81917e6959"
                }
            }
        },
        "ALBListenerNoWAF": {
            "Type": "AWS::ElasticLoadBalancingV2::Listener",
            "Properties": {
                "DefaultActions": [
                    {
                        "Type": "forward",
                        "TargetGroupArn": {
                            "Ref": "ALBTargetGroupNoWAF"
                        }
                    }
                ],
                "LoadBalancerArn": {
                    "Ref": "ApplicationLoadBalancerNoWAF"
                },
                "Port": "443",
                "Protocol": "HTTPS",
                "Certificates": [
                    {
                        "CertificateArn": {
                            "Ref": "certificateARN"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "e07512b6-ca52-446b-bced-093669ad570f"
                }
            }
        },
        "ALBTargetGroupNoWAF": {
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": {
                "Port": 80,
                "Protocol": "HTTP",
                "VpcId": {
                    "Ref": "VpcID"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8514e786-03f2-4ffb-9cfb-2f4098ea3af9"
                }
            }
        },
        "ApplicationLoadBalancerNoWAF": {
            "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
            "Properties": {
                "Subnets": [
                    {
                        "Ref": "PublicSubnetKey1"
                    },
                    {
                        "Ref": "PublicSubnetKey2"
                    },
                    {
                        "Ref": "PublicSubnetKey3"
                    }
                ],
                "SecurityGroups": [
                    {
                        "Ref": "LBSecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "fadb63fa-7693-49ed-a61b-c58a37014d4f"
                }
            }
        }
    },
    "Outputs": {
        "wafWebACL": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrOwaspACL"
                    },
                    {
                        "Ref": "wafgOwaspACL"
                    }
                ]
            }
        },
        "wafWebACLMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "owaspacl"
                    ]
                ]
            }
        },
        "wafSQLiRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrSQLiRule"
                    },
                    {
                        "Ref": "wafgSQLiRule"
                    }
                ]
            }
        },
        "wafSQLiRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "mitigatesqli"
                    ]
                ]
            }
        },
        "wafAuthTokenRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrAuthTokenRule"
                    },
                    {
                        "Ref": "wafgAuthTokenRule"
                    }
                ]
            }
        },
        "wafAuthTokenRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "badauthtokens"
                    ]
                ]
            }
        },
        "wafXSSRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrXSSRule"
                    },
                    {
                        "Ref": "wafgXSSRule"
                    }
                ]
            }
        },
        "wafXSSRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "mitigatexss"
                    ]
                ]
            }
        },
        "wafPathsRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrPathsRule"
                    },
                    {
                        "Ref": "wafgPathsRule"
                    }
                ]
            }
        },
        "wafPathsRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "detectrfilfi"
                    ]
                ]
            }
        },
        "wafPHPMisconfigRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrPHPInsecureRule"
                    },
                    {
                        "Ref": "wafgPHPInsecureRule"
                    }
                ]
            }
        },
        "wafPHPMisconfigRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "detectphpinsecure"
                    ]
                ]
            }
        },
        "wafAdminAccessRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrAdminAccessRule"
                    },
                    {
                        "Ref": "wafgAdminAccessRule"
                    }
                ]
            }
        },
        "wafAdminAccessRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "detectadminaccess"
                    ]
                ]
            }
        },
        "wafCSRFRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrCSRFRule"
                    },
                    {
                        "Ref": "wafgCSRFRule"
                    }
                ]
            }
        },
        "wafCSRFRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "enforcecsrf"
                    ]
                ]
            }
        },
        "wafSSIRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrServerSideIncludeRule"
                    },
                    {
                        "Ref": "wafgServerSideIncludeRule"
                    }
                ]
            }
        },
        "wafSSIRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "detectssi"
                    ]
                ]
            }
        },
        "wafBlacklistIpRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrBlacklistIpRule"
                    },
                    {
                        "Ref": "wafgBlacklistIpRule"
                    }
                ]
            }
        },
        "wafBlacklistIpRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "blacklistedips"
                    ]
                ]
            }
        },
        "wafSizeRestrictionRule": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrSizeRestrictionRule"
                    },
                    {
                        "Ref": "wafgSizeRestrictionRule"
                    }
                ]
            }
        },
        "wafSizeRestrictionRuleMetric": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Ref": "stackPrefix"
                        },
                        "restrictsizes"
                    ]
                ]
            }
        },
        "wafAuthTokenBlacklist": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrAuthTokenStringSet"
                    },
                    {
                        "Ref": "wafgAuthTokenStringSet"
                    }
                ]
            }
        },
        "wafAdminAccessWhitelist": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrAdminRemoteAddrIpSet"
                    },
                    {
                        "Ref": "wafgAdminRemoteAddrIpSet"
                    }
                ]
            }
        },
        "wafIpBlacklist": {
            "Value": {
                "Fn::If": [
                    "isRegional",
                    {
                        "Ref": "wafrBlacklistIpSet"
                    },
                    {
                        "Ref": "wafgBlacklistIpSet"
                    }
                ]
            }
        }
    }
}